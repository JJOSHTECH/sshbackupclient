#!/bin/bash

echo "$(date +%Y-%m-%d\ %H:%M) Backup Started"
curl -sX POST -H 'Content-type: application/json' --data '{"text":"Backup Started\n'"$(df -h /var/backup/)"'"}' $SLACK_HOOK

rsyncOutput="$(rsync -vaze "ssh -p $PORT" root@$SERVER_ADDRESS:/var/backup/ /var/backup/  | sed '0,/^$/d')"
echo "$(date +%Y-%m-%d\ %H:%M) $rsyncOutput"

echo "$(date +%Y-%m-%d\ %H:%M) Backup Started"
curl -sX POST -H 'Content-type: application/json' --data '{"text":"Backup Finished\n'"$(df -h /var/backup/)"'\n'$rsyncOutput'"}' $SLACK_HOOK
